apiVersion: v1
kind: Pod
metadata:
  name: pod-with-init-containers
  namespace: default
spec:
  initContainers:
  - name: init-db
    image: busybox:1.35
    command: ['sh', '-c', 'until nc -z db-service 5432; do sleep 2; done']
  - name: init-config
    image: busybox:1.35
    command: ['sh', '-c', 'cp /config/* /app/config/']
    volumeMounts:
    - name: config
      mountPath: /config
    - name: app-config
      mountPath: /app/config
  containers:
  - name: app
    image: myapp:1.0
    volumeMounts:
    - name: app-config
      mountPath: /app/config
  volumes:
  - name: config
    configMap:
      name: app-config
  - name: app-config
    emptyDir: {}
